const searchBtn = document.getElementById("search-btn");
const wordInput = document.getElementById("word-input");
const resultBox = document.getElementById("result");
const wordEl = document.getElementById("word");
const phoneticEl = document.getElementById("phonetic");
const meaningsEl = document.getElementById("meanings");
const playBtn = document.getElementById("play-sound");
const saveFavBtn = document.getElementById("save-fav");
const favList = document.getElementById("fav-list");
const historyList = document.getElementById("history-list");
const themeToggle = document.getElementById("theme-toggle");

let audio;
let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
let history = JSON.parse(localStorage.getItem("history")) || [];

function updateSidebar() {
  favList.innerHTML = favorites.map(w => `<li onclick="searchWord('${w}')">${w}</li>`).join("");
  historyList.innerHTML = history.map(w => `<li onclick="searchWord('${w}')">${w}</li>`).join("");
}

async function searchWord(word) {
  if (!word) return;
  wordInput.value = word;

  const res = await fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
  const data = await res.json();

  if (data.title) {
    alert("Word not found!");
    return;
  }

  const info = data[0];
  wordEl.textContent = info.word;
  phoneticEl.textContent = info.phonetics[0]?.text || "";

  // Audio
  if (info.phonetics[0]?.audio) {
    audio = new Audio(info.phonetics[0].audio);
    playBtn.style.display = "inline";
  } else {
    playBtn.style.display = "none";
  }

  // Meanings
  meaningsEl.innerHTML = "";
  info.meanings.forEach(m => {
    const div = document.createElement("div");
    div.classList.add("meaning");
    div.innerHTML = `
      <p><strong>${m.partOfSpeech}</strong></p>
      ${m.definitions.map(d => `<p>â€¢ ${d.definition}</p><em>${d.example || ""}</em>`).join("")}
    `;
    meaningsEl.appendChild(div);
  });

  resultBox.classList.remove("hidden");

  // Save history
  if (!history.includes(word)) {
    history.unshift(word);
    if (history.length > 5) history.pop();
    localStorage.setItem("history", JSON.stringify(history));
  }
  updateSidebar();
}

// Search event
searchBtn.addEventListener("click", () => {
  searchWord(wordInput.value.trim());
});

// Play pronunciation
playBtn.addEventListener("click", () => {
  if (audio) audio.play();
});

// Save to favorites
saveFavBtn.addEventListener("click", () => {
  const word = wordEl.textContent;
  if (word && !favorites.includes(word)) {
    favorites.push(word);
    localStorage.setItem("favorites", JSON.stringify(favorites));
    updateSidebar();
  }
});

// Theme toggle
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("light");
  themeToggle.textContent = document.body.classList.contains("light") ? "ðŸŒž" : "ðŸŒ™";
});

// Load sidebar on start
updateSidebar();
